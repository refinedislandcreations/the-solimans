
<!-- Sticky controls -->
<section class="sticky top-16 z-20 bg-neutral-950/95 backdrop-blur supports-[backdrop-filter]:backdrop-blur border-y border-white/5">
    <div class="mx-auto max-w-6xl px-6 py-4">
        <div class="flex flex-col items-center text-center">
            <h1 data-reveal class="font-display text-5xl md:text-7xl leading-[0.95]">
              {{ page.how.kicker | default: "Let's Get To The Fun Part" }}
            </h1>
        </div>
      <div class="flex flex-col md:flex-row md:items-center gap-3 md:gap-6 mt-8">
        <!-- Categories as tabs -->
        <div class="flex flex-wrap gap-2" id="catTabs">
          {% assign cats = site.data.meal-plans.categories | default: site.data.meal-plans.categories %}
          {% for c in cats %}
            {% assign cname = c.name | downcase %}
            <button type="button"
                    class="capitalize cat-tab px-4 py-2 rounded-full border border-white/10 text-white hover:text-white hover:border-white/20 transition data-[active=true]:bg-[#919b4a] data-[active=true]:font-bold data-[active=true]:text-white data-[active=true]:border-transparent"
                    data-cat="{{ cname | escape }}">
              {{ c.name }}
            </button>
          {% endfor %}
        </div>
  
        <div class="md:ml-auto flex items-center gap-3">
          <label class="text-white/60 text-sm flex  items-center gap-2 ">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar-days-icon lucide-calendar-days"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/><path d="M8 14h.01"/><path d="M12 14h.01"/><path d="M16 14h.01"/><path d="M8 18h.01"/><path d="M12 18h.01"/><path d="M16 18h.01"/></svg>
            Week
          </label>
          <select id="weekSelect" class="rounded-lg bg-white/5 border border-white/10 px-3 py-2 text-sm text-white">
            <!-- options diisi via JS sesuai kategori -->
          </select>
          <!-- <a href="{{ '/meal-plan-request/' | relative_url }}"
             class="inline-flex items-center gap-2 bg-[#919b4a] text-white font-semibold px-4 py-2 hover:opacity-90 transition">
            <svg class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor"><path d="M5 12h11l-4-4 1.4-1.4L20.8 12l-7.4 7.4L12 18l4-4H5z"/></svg>
            Start Request
          </a> -->
        </div>
      </div>
    </div>
  </section>
  
  <!-- Content -->
  <section class="py-10 md:py-14 bg-neutral-975">
    <div class="mx-auto max-w-6xl px-6">
  
      {% comment %} Build all sections (category x week) {% endcomment %}
      {% assign all_weeks = site.data.meal-plans.weeks %}
      {% for c in site.data.meal-plans.categories %}
        {% assign cname = c.name | downcase %}
        {% for w in all_weeks %}
          {% assign wcat = w.category | downcase %}
          {% if wcat == cname %}
            <section class="cat-week hidden" data-cat="{{ cname }}" data-week="{{ w.week }}">
              <h2 class="sr-only">{{ c.name }} — Week {{ w.week }}</h2>
  
              {% for d in w.days %}
                <details class="group mb-6 rounded-2xl border border-white/10 bg-white/5 overflow-hidden">
                  <summary class="flex items-center justify-between cursor-pointer select-none px-5 py-4">
                    <div class="flex items-center gap-3">
                      <span class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-[#919b4a]/15 text-[#919b4a] font-bold">{{ forloop.index }}</span>
                      <span class="font-semibold">{{ d.day }}</span>
                    </div>
                    <svg class="h-5 w-5 text-white/70 transition-transform group-open:rotate-180" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M6 9l6 6 6-6"/></svg>
                  </summary>
  
                  <div class="px-5 pb-5">
                    <div class="grid gap-5 sm:grid-cols-2 lg:grid-cols-3">
                      {% for m in d.meals %}
                        <article class="meal-card rounded-xl overflow-hidden border border-white/10 bg-neutral-900/60 shadow-sm hover:shadow-md transition will-change-transform"
                                 data-reveal>
                          <div class="relative">
                            <img loading="lazy"
                                 src="{{ m.image | relative_url }}"
                                 alt="{{ m.alt | default: m.name | escape }}"
                                 class="h-44 w-full object-cover">
                            <div class="absolute inset-x-0 bottom-0 h-20 bg-gradient-to-t from-black/70 to-transparent"></div>
                            <div class="absolute left-3 bottom-3 inline-flex items-center gap-2 rounded-full bg-black/60 px-3 py-1 text-xs">
                              <span class="inline-flex items-center gap-1">
                                <svg class="h-3.5 w-3.5" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2a10 10 0 100 20 10 10 0 000-20zM7 12h10"/></svg>
                                {{ m.calories }} kcal
                              </span>
                              <span class="opacity-60">•</span>
                              <span>{{ m.protein }}</span>
                            </div>
                          </div>
                          <div class="p-4">
                            <h3 class="font-semibold">{{ m.name }}</h3>
                            <div class="mt-2 flex flex-wrap gap-2 text-[11px] text-white/80">
                              <span class="rounded-full bg-white/5 border border-white/10 px-2 py-1">Protein: {{ m.protein }}</span>
                              <span class="rounded-full bg-white/5 border border-white/10 px-2 py-1">Carbs: {{ m.carbs }}</span>
                              <span class="rounded-full bg-white/5 border border-white/10 px-2 py-1">Fat: {{ m.fat }}</span>
                            </div>
  
                            {% if m.ingredients %}
                            <details class="mt-3 rounded-lg border border-white/10 bg-white/5">
                              <summary class="text-sm px-3 py-2 cursor-pointer select-none">Ingredients</summary>
                              <ul class="px-3 pb-3 pt-1 text-sm text-white/80 grid grid-cols-2 gap-x-4 gap-y-1">
                                {% for ing in m.ingredients %}
                                  <li class="flex items-center gap-2">
                                    <svg class="h-3.5 w-3.5 text-[#919b4a]" viewBox="0 0 24 24" fill="currentColor"><path d="M9 12l2 2 4-4 2 2-6 6-4-4z"/></svg>
                                    <span>{{ ing }}</span>
                                  </li>
                                {% endfor %}
                              </ul>
                            </details>
                            {% endif %}
                          </div>
                        </article>
                      {% endfor %}
                    </div>
                  </div>
                </details>
              {% endfor %}
            </section>
          {% endif %}
        {% endfor %}
      {% endfor %}
  
      <!-- CTA -->
      <div class="mt-10 text-center">
        <a href="{{ '/meal-plan-request/' | relative_url }}"
           class="uppercase inline-flex items-center gap-2 bg-[#919b4a] text-white font-bold px-6 py-3 hover:opacity-90 transition">
          <svg class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor"><path d="M5 12h11l-4-4 1.4-1.4L20.8 12l-7.4 7.4L12 18l4-4H5z"/></svg>
          Start Your Plan
        </a>
      </div>
  
    </div>
  </section>
  
  <script>
  (function(){
    // Collect sections
    const sections = Array.from(document.querySelectorAll('.cat-week'));
    if (!sections.length) return;
  
    // Build category list from tabs
    const tabs = Array.from(document.querySelectorAll('.cat-tab'));
    const weekSelect = document.getElementById('weekSelect');
  
    function getWeeksForCat(cat){
      const set = new Set();
      sections.filter(s => s.dataset.cat === cat).forEach(s => set.add(s.dataset.week));
      return Array.from(set).sort((a,b)=>Number(a)-Number(b));
    }
  
    // Init selected cat/week
    let currentCat = (tabs[0]?.dataset.cat) || sections[0].dataset.cat;
    let currentWeek = getWeeksForCat(currentCat)[0] || '1';
  
    function renderTabs(){
      tabs.forEach(t => t.dataset.active = (t.dataset.cat === currentCat));
    }
  
    function renderWeekOptions(){
      const weeks = getWeeksForCat(currentCat);
      weekSelect.innerHTML = weeks.map(w => `<option value="${w}" ${w==currentWeek?'selected':''}>${w}</option>`).join('');
    }
  
    function renderSections(){
      sections.forEach(s => {
        const show = (s.dataset.cat === currentCat && s.dataset.week === String(currentWeek));
        s.classList.toggle('hidden', !show);
      });
    }
  
    tabs.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        currentCat = btn.dataset.cat;
        currentWeek = getWeeksForCat(currentCat)[0] || '1';
        renderTabs(); renderWeekOptions(); renderSections();
      });
    });
  
    weekSelect.addEventListener('change', e=>{
      currentWeek = e.target.value;
      renderSections();
    });
  
    renderTabs(); renderWeekOptions(); renderSections();
  
    // Reveal animation
    const cards = document.querySelectorAll('[data-reveal]');
    const io = new IntersectionObserver(entries=>{
      entries.forEach(e=>{
        if (e.isIntersecting){
          e.target.animate(
            [{opacity:0, transform:'translateY(10px) scale(.98)'}, {opacity:1, transform:'translateY(0) scale(1)'}],
            {duration:450, easing:'cubic-bezier(.2,.8,.2,1)'}
          );
          io.unobserve(e.target);
        }
      });
    }, {threshold:.15});
    cards.forEach(c=>io.observe(c));
  })();
  </script>
  
  <style>
  /* subtle bg for content area */
  .bg-neutral-975{ background-color:#0b0b0b; }
  /* details smooth open */
  details[open] > summary svg{ transform:rotate(180deg); }
  details > summary::-webkit-details-marker{ display:none; }
  </style>
  